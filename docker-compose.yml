# ============================================================
# Hytale Dedicated Server - Docker Compose
# ============================================================
#
# PORTAINER SETUP:
# 1. Repository URL eingeben
# 2. Environment Variables setzen (siehe .env.example)
# 3. Deploy
# 4. Nach Start: /auth login device
#
# LOKAL:
# 1. cp .env.example .env
# 2. .env anpassen
# 3. docker-compose up -d
#
# ============================================================

services:
  hytale:
    build: .
    image: hytale-server:latest
    container_name: hytale
    hostname: hytale
    restart: on-failure:3
    
    environment:
      # Java / RAM
      - JAVA_MIN_RAM=${JAVA_MIN_RAM:-3G}
      - JAVA_MAX_RAM=${JAVA_MAX_RAM:-4G}
      
      # Server
      - SERVER_PORT=${SERVER_PORT:-5520}
      - SERVER_BIND=${SERVER_BIND:-0.0.0.0}
      - TZ=${TZ:-Europe/Berlin}
      
      # Backups
      - ENABLE_BACKUP=${ENABLE_BACKUP:-true}
      - BACKUP_FREQUENCY=${BACKUP_FREQUENCY:-30}
      
      # Auth
      - AUTH_MODE=${AUTH_MODE:-}
      
      # Download URLs (Option 1)
      - SERVER_JAR_URL=${SERVER_JAR_URL:-}
      - ASSETS_URL=${ASSETS_URL:-}
      
      # Hytale Downloader (Option 2)
      - USE_HYTALE_DOWNLOADER=${USE_HYTALE_DOWNLOADER:-false}
      - HYTALE_PATCHLINE=${HYTALE_PATCHLINE:-release}

    # Ports - UDP!
    ports:
      - "${SERVER_PORT:-5520}:${SERVER_PORT:-5520}/udp"
    
    # Volumes
    volumes:
      - hytale-server:/opt/hytale/server
      - hytale-data:/opt/hytale/data
      - hytale-backups:/opt/hytale/backups
      - hytale-plugins:/opt/hytale/plugins
      - hytale-mods:/opt/hytale/mods
      - hytale-downloader:/opt/hytale/downloader

    # Console
    stdin_open: true
    tty: true
    
    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"

volumes:
  hytale-server:
    name: hytale-server
  hytale-data:
    name: hytale-data
  hytale-backups:
    name: hytale-backups
  hytale-plugins:
    name: hytale-plugins
  hytale-mods:
    name: hytale-mods
  hytale-downloader:
    name: hytale-downloader
